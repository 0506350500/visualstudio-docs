---
title: "CA5379: Do Not Use Weak Key Derivation Function Algorithm"
description: Provides information about code analysis rule CA5379, including causes, how to fix violations, and when to suppress it.
ms.date: 05/07/2020
ms.topic: reference
author: LLLXXXCCC
ms.author: linche
manager: jillfra
ms.workload:
  - "multiple"
f1_keywords:
  - "CA5379"
  - "DoNotUseWeakKDFAlgorithm"
---
# CA5379: Do Not Use Weak Key Derivation Function Algorithm

|||
|-|-|
|CheckId|CA5379|
|Category|Microsoft.Security|
|Breaking change|Non-breaking|

## Cause

Using <xref:System.Security.Cryptography.MD5?displayProperty=nameWithType> or <xref:System.Security.Cryptography.SHA1?displayProperty=nameWithType> when instantiating <xref:System.Security.Cryptography.Rfc2898DeriveBytes?displayProperty=nameWithType>.

## Rule description

Some implementations of the <xref:System.Security.Cryptography.Rfc2898DeriveBytes> class allow for a hashAlgorithm to be specified in the constructor parameter or overwritten in <xref:System.Security.Cryptography.Rfc2898DeriveBytes.HashAlgorithm?displayProperty=nameWithType> property. If this exists, then it should be used with <xref:System.Security.Cryptography.SHA256?displayProperty=nameWithType> or higher as the hashAlgorithm parameter.

## How to fix violations

Because <xref:System.Security.Cryptography.MD5> or <xref:System.Security.Cryptography.SHA1> have found to be vulnerable, using <xref:System.Security.Cryptography.SHA256> or higher when specifying the hash algorithm name for <xref:System.Security.Cryptography.Rfc2898DeriveBytes> or its derived classes.

## When to suppress warnings

It is not recommended to suppress this rule unless for application compatibility reason.

## Pseudo-code examples

### Specify the hashAlgorithm parameter of <xref:System.Security.Cryptography.Rfc2898DeriveBytes>

```csharp
using System.Security.Cryptography;

class ExampleClass
{
    public void ExampleMethod(byte[] password, byte[] salt, int iterations, HashAlgorithmName hashAlgorithm)
    {
        var rfc2898DeriveBytes = new Rfc2898DeriveBytes(password, salt, iterations, HashAlgorithmName.MD5);
    }
}

```

### Specify the hashAlgorithm parameter of derived classes of <xref:System.Security.Cryptography.Rfc2898DeriveBytes>

```csharp
using System.Security.Cryptography;

class DerivedClass : Rfc2898DeriveBytes
{
    public DerivedClass (byte[] password, byte[] salt, int iterations, HashAlgorithmName hashAlgorithm) : base(password, salt, iterations, hashAlgorithm)
    {
    }
}

class ExampleClass
{
    public void ExampleMethod(byte[] password, byte[] salt, int iterations, HashAlgorithmName hashAlgorithm)
    {
        var derivedClass = new DerivedClass(password, salt, iterations, HashAlgorithmName.MD5);
    }
}

```

### Specify the HashAlgorithm property of derived classes of <xref:System.Security.Cryptography.Rfc2898DeriveBytes>

```csharp
using System.Security.Cryptography;

class DerivedClass : Rfc2898DeriveBytes
{
    public DerivedClass (byte[] password, byte[] salt, int iterations, HashAlgorithmName hashAlgorithm) : base(password, salt, iterations, hashAlgorithm)
    {
    }

    public HashAlgorithmName HashAlgorithm { get; set;}
}

class ExampleClass
{
    public void ExampleMethod(byte[] password, byte[] salt, int iterations, HashAlgorithmName hashAlgorithm)
    {
        var derivedClass = new DerivedClass(password, salt, iterations, HashAlgorithmName.MD5);
        derivedClass.HashAlgorithm = HashAlgorithmName.SHA256;
    }
}
```

### Solution

```csharp
using System.Security.Cryptography;

class ExampleClass
{
    public void ExampleMethod(byte[] password, byte[] salt, int iterations, HashAlgorithmName hashAlgorithm)
    {
        var rfc2898DeriveBytes = new Rfc2898DeriveBytes(password, salt, iterations, HashAlgorithmName.SHA256);
    }
}
```
