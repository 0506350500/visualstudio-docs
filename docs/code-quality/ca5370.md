---
title: "CA5370: Use XmlReader for validating reader"
description: Provides information about code analysis rule CA5370, including causes, how to fix violations, and when to suppress it.
ms.date: 08/14/2019
ms.topic: reference
author: EvaSchmotzerova
ms.author: filipse
manager: jillfra
dev_langs:
 - CSharp
ms.workload:
  - "multiple"
f1_keywords:
  - "CA5370"
  - "UseXMLReaderForValidatingReader"
---
# CA5370: Use XmlReader for validating reader

|||
|-|-|
|TypeName|UseXMLReaderForValidatingReader|
|CheckId|CA5370|
|Category|Microsoft.Security|
|Breaking Change|Non Breaking|

## Cause

Validating untrusted XML input with `XmlValidatingReader` Class instantiated without an `XmlReader` object can potentially lead to denial of service, information disclosure, and server-side request forgery. These attacks are enabled by untrusted DTD and XML schema processing allowing for the inclusion of XML bombs and malicious external entities in the XML. Only with `XmlReader` it is possible to disable DTD and inline XML schema processing as `XmlReader` has the `ProhibitDtd` and `ProcessInlineSchema` property set to `false` by default in .NET Framework >=4.0.

## Rule description

Processing untrusted DTD and XML schemas may enable loading dangerous external references, which should be restricted by using an `XmlReader` with a secure resolver or with DTD and XML inline schema processing disabled. This rule detects code using `XmlValidatingReader` Class without `XmlReader` as a constructor parameter.

## How to fix violations

- Use `XmlValidatingReader(XmlReader)` with `ProhibitDtd` and `ProcessInlineSchema` properties set to `false`.
- Since starting .NET Framework 2.0, `XmlValidatingReader` is considered obsolete, you can instantiate a validating reader with <xref:System.Xml.Xmlreader.Create%2A?displayProperty=nameWithType>.

## When to suppress warnings

You can potentially suppress this warning if the `XmlValidatingReader` is always used to validate XML that comes from a trusted source and hence cannot be tampered with. 

## Pseudo-code examples

### Violation

As of the time of this writing, the following pseudo-code sample illustrates the pattern detected by this rule.
The type of the first parameter of `XmlValidatingReader.XmlValidatingReader()` is not `XmlReader`.

```csharp
using System;
using System.IO;
using System.Xml;
...
public void TestMethod(Stream xmlFragment, XmlNodeType fragType, XmlParserContext context)
{
var obj = new XmlValidatingReader(xmlFragment, fragType, context);
}
```

### Solution

```csharp
using System;
using System.Xml;
...
public void TestMethod(XmlReader xmlReader)
{
var obj = new XmlValidatingReader(xmlReader);
}
```