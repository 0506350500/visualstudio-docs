---
title: "CA5371: Use XmlReader for schema read"
description: Provides information about code analysis rule CA5371, including causes, how to fix violations, and when to suppress it.
ms.date: 08/14/2019
ms.topic: reference
author: EvaSchmotzerova
ms.author: filipse
manager: jillfra
dev_langs:
 - CSharp
ms.workload:
  - "multiple"
f1_keywords:
  - "CA5371"
  - "UseXmlReaderForSchemaRead"
---
# CA5371: Use XmlReader for schema read

|||
|-|-|
|TypeName|UseXmlReaderForSchemaRead|
|CheckId|CA5371|
|Category|Microsoft.Security|
|Breaking Change|Non Breaking|

## Cause

Processing untrusted XML input with <xref:System.Xml.Schema.Xmlschema.Read%2A?displayProperty=nameWithType> instantiated without an `XmlReader` object can potentially lead to denial of service, information disclosure and server-side request forgery attacks. These attacks are enabled by untrusted DTD and XML schema processing allowing for the inclusion of XML bombs and malicious external entities in the XML. Only with `XmlReader` it is possible to disable DTD and inline XML schema processing as `XmlReader` has the `ProhibitDtd` and `ProcessInlineSchema` property set to false by default in .NET Framework >=4.0.The  other options such as `Stream`, `TextReader` and `XmlSerializationReader` cannot disable DTD processing.

## Rule description

Processing untrusted DTD and XML schemas may enable loading dangerous external references, which should be restricted by using an `XmlReader` with a secure resolver or with DTD and XML inline schema processing disabled. This rule detects code using <xref:system.xml.schema.xmlschema.read%2A?displayProperty=nameWithType> method without `XmlReader` as a parameter.

## How to fix violations

Use `XmlSchema.Read(XmlReader, *)` overloads.

## When to suppress warnings

You can potentially suppress this warning if the <xref:System.Xml.Schema.Xmlschema.Read%2A?displayProperty=nameWithType> is always used to process XML that comes from a trusted source and hence cannot be tampered with.

## Pseudo-code examples

### Violation

As of the time of this writing, the following pseudo-code sample illustrates the pattern detected by this rule.
The type of the first parameter of <xref:System.Xml.Schema.Xmlschema.Read%2A?displayProperty=nameWithType> is not `XmlReader`.

```csharp
using System.IO;
using System.Xml.Schema;
...
public void TestMethod(Stream stream, ValidationEventHandler validationEventHandler)
{
XmlSchema.Read(stream, validationEventHandler);
}
```

### Solution

```csharp
using System.IO;
using System.Xml.Schema;
...
public void TestMethod(XmlReader reader, ValidationEventHandler validationEventHandler)
{
XmlSchema.Read(reader, validationEventHandler);
} 
```